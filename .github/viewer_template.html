<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([-14.2350,-51.9253], 4);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom: 18}).addTo(map);

  const layerGroup = L.layerGroup().addTo(map);
  const sel = document.getElementById('fileSel');

  async function loadManifest() {
    const files = await fetch('manifest.json').then(r=>r.json());
    sel.innerHTML = '';
    for (const f of files) {
      const opt = document.createElement('option');
      opt.value = f; opt.textContent = f;
      sel.appendChild(opt);
    }
    if (files.length) { loadFile(files[0]); }
  }

  function styleFn(f) {
    const color = (f && f.properties && f.properties.color) || '#3388ff';
    return { color, weight: 2, fillOpacity: 0.25 };
  }

  async function loadFile(name) {
    const data = await fetch(name).then(r=>r.json());
    layerGroup.clearLayers();

    // desenha Polygons/Lines com estilo e Points como circleMarker
    const gj = L.geoJSON(data, {
      style: styleFn,
      pointToLayer: (feature, latlng) => L.circleMarker(latlng, {
        radius: 6, weight: 2, fillOpacity: 0.9
      })
    }).addTo(layerGroup);

    // calcula bounds e força zoom quando for só ponto
    const bounds = gj.getBounds();
    if (bounds && bounds.isValid()) {
      const sw = bounds.getSouthWest();
      const ne = bounds.getNorthEast();
      const isPointBounds = sw.equals(ne);
      if (isPointBounds) {
        map.setView(bounds.getCenter(), 15); // foca no ponto
      } else {
        map.fitBounds(bounds, { padding: [20, 20] });
      }
    }
  }

  sel.addEventListener('change', e => loadFile(e.target.value));
  loadManifest();
</script>